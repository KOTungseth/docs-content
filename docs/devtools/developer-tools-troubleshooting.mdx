---
id: serverlessElasticsearchDevToolsTroubleshooting
slug: /serverless/elasticsearch/dev-tools-troubleshooting
title: Troubleshooting
description: Troubleshoot searches in Elasticsearch
tags: [ 'serverless', 'elasticsearch', 'troubleshooting' ]
status: in review
---

When you query your data, Elasticsearch may return an error, no search results,
or results in an unexpected order. This guide describes how to troubleshoot
searches.

## Ensure the data stream, index, or alias exists

Elasticsearch returns an `index_not_found_exception` when the data stream, index
or alias you try to query does not exist. This can happen when you misspell the
name or when the data has been indexed to a different data stream or index.

Use the [**Exists API**](((ref))/indices-exists.html) {/*  <DocLink id="enElasticsearchReferenceIndicesExists">exists API</DocLink> */} to check whether a data stream, index, or
alias exists:

```bash
curl ${ES_URL}/my-data-stream \
-H "Authorization: ApiKey ${API_KEY}"
```

Use the [**Data stream stats API**](((ref))/data-stream-stats-api.html)
{/*  <DocLink id="enElasticsearchReferenceDataStreamStatsApi">data stream stats API</DocLink> */} to list all data streams:

```bash
curl "${ES_URL}/_data_stream/_stats?human=true" \
-H "Authorization: ApiKey ${API_KEY}"
```

Use the [**Get index API**](((ref))/indices-get-index.html)
 {/*  <DocLink id="enElasticsearchReferenceIndicesGetIndex">get index API</DocLink> */} to list all indices and their aliases:

```bash
curl "${ES_URL}/_all?filter_path=*.aliases" \
-H "Authorization: ApiKey ${API_KEY}"
```

Instead of an error, it is possible to retrieve partial search results if some 
of the indices you're querying are unavailable.
Set `ignore_unavailable` to `true`:

```bash
curl "${ES_URL}/my-alias/_search?ignore_unavailable=true" \
-H "Authorization: ApiKey ${API_KEY}"
```

## Ensure the data stream or index contains data

When a search request returns no hits, the data stream or index may contain no
data.
This can happen when there is a data ingestion issue.
For example, the data may have been indexed to a data stream or index with another name.

Use the [**Count API**](((ref))/search-count.html) 
{/*  <DocLink id="enElasticsearchReferenceSearchCount">count API</DocLink> */} to retrieve the number of documents in a data
stream or index.
Check that `count` in the response is not 0.

```bash
curl -X PUT "${ES_URL}/my-index-000001" \
-H "kbn-xsrf: reporting" \
-H "Authorization: ApiKey ${API_KEY}"
```

{/*

```bash
curl -X PUT "${ES_URL}/my-index-000001" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "mappings": {
    "properties": {
      "@timestamp": {
        "type": "date"
      },
      "my-field": {
        "type": "keyword"
      },
      "my-num-field": {
        "type": "integer"
      }
    }
  }
}'
```

*/}

```bash
curl "${ES_URL}/my-index-000001/_count" \
-H "Authorization: ApiKey ${API_KEY}"
```
{/* TEST[continued] */}

<DocCallOut title="Note">
If you aren't getting search results in the UI, check that you have selected the
correct data view and a valid time range. Also, ensure the data view has been
configured with the correct time field.
</DocCallOut>

## Check that the field exists and its capabilities

Querying a field that does not exist will not return any results.
Use the [**Field capabilities API**](((ref))/search-field-caps.html)
{/* <DocLink id="enElasticsearchReferenceSearchFieldCaps">field capabilities API</DocLink> */} to check whether a field exists:

```bash
curl "${ES_URL}/my-index-000001/_field_caps?fields=my-field" \
-H "Authorization: ApiKey ${API_KEY}"
```
{/* TEST[continued] */}

If the field does not exist, check the data ingestion process.
The field may have a different name.

If the field exists, the request will return the field's type and whether it is
searchable and aggregatable.

```console-response
{
  "indices": [
    "my-index-000001"
  ],
  "fields": {
    "my-field": {
      "keyword": {
        "type": "keyword",          [^1]
        "metadata_field": false,
        "searchable": true,         [^2]
        "aggregatable": true        [^3]
      }
    }
  }
}
```
[^1]: The field is of type `keyword` in this index.
[^2]: The field is searchable in this index.
[^3]: The field is aggregatable in this index.

## Check the field's mappings

A field's capabilities are determined by its [mapping](((ref))/mapping.html). {/*  <DocLink id="enElasticsearchReferenceMapping">mapping</DocLink> */}
To retrieve the mapping, use the [**Get mapping API**](((ref))/indices-get-mapping.html): {/*  <DocLink id="enElasticsearchReferenceIndicesGetMapping">get mapping API</DocLink> */}

```bash
curl "${ES_URL}/my-index-000001/_mappings" \
-H "Authorization: ApiKey ${API_KEY}"
```
{/* TEST[continued] */}

If you query a `text` field, pay attention to the analyzer that may have been
configured.
You can use the [**Analyze API**](((ref))/indices-analyze.html)
 {/*  <DocLink id="enElasticsearchReferenceIndicesAnalyze">analyze API</DocLink> */} to check how a field's analyzer processes values and query terms:

```bash
curl -X POST "${ES_URL}/my-index-000001/_analyze" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "field": "my-field",
  "text": "this is a test"
}'
```
{/* TEST[continued] */}

To change the mapping of an existing field use the [**Update mapping API**](((ref))/indices-put-mapping.html).

## Check the field's values

Use the `exists` query {/*  <DocLink id="enElasticsearchReferenceQueryDslExistsQuery">`exists` query</DocLink> */} to check whether there are
documents that return a value for a field.
Check that `count` in the response is
not 0.

```bash
curl -X GET "${ES_URL}/my-index-000001/_count" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "query": {
    "exists": {
      "field": "my-field"
    }
  }
}'
```
{/* TEST[continued] */}

If the field is aggregatable, you can use [aggregations](((ref))/search-aggregations.html) {/*  <DocLink id="enElasticsearchReferenceSearchAggregations">aggregations</DocLink> */}
to check the field's values.
For `keyword` fields, you can use a `terms` aggregation
 {/* <DocLink id="enElasticsearchReferenceSearchAggregationsBucketTermsAggregation">terms aggregation</DocLink> */} to retrieve
the field's most common values:

```bash
curl -X GET "${ES_URL}/my-index-000001/_search?filter_path=aggregations" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "size": 0,
  "aggs": {
    "top_values": {
      "terms": {
        "field": "my-field",
        "size": 10
      }
    }
  }
}'
```
{/* TEST[continued] */}

For numeric fields, you can use [stats aggregation](((ref))/search-aggregations-metrics-stats-aggregation.html) {/* <DocLink id="enElasticsearchReferenceSearchAggregationsMetricsStatsAggregation">stats aggregation</DocLink> */}  to get an idea of the field's value distribution:

```shell
curl -X GET "${ES_URL}/my-index-000001/_search?filter_path=aggregations" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "aggs": {
    "my-num-field-stats": { 
      "stats": {
        "field": "my-num-field"
      }
    }
  }
}'
```
{/* TEST[continued] */}

If the field does not return any values, check the data ingestion process.
The field may have a different name.

## Check the latest value

For time-series data, confirm there is non-filtered data within the attempted
time range. 
For example, if you are trying to query the latest data for the
`@timestamp` field, run the following to see if the max `@timestamp` falls
within the attempted range:

```bash
curl "${ES_URL}/my-index-000001/_search?sort=@timestamp:desc&size=1" \
-H "Authorization: ApiKey ${API_KEY}"
```
{/* TEST[continued] */}

<div id="troubleshooting-searches-validate-explain-profile"></div>

## Validate, explain, and profile queries

When a query returns unexpected results, Elasticsearch offers several tools to
investigate why.

The [**Validate API**](((ref))/search-validate.html) {/*  <DocLink id="enElasticsearchReferenceSearchValidate">validate API</DocLink> */} 
enables you to validate a query. 
Use the `rewrite` parameter to return the Lucene query an Elasticsearch query is
rewritten into:

```bash
curl -X GET "${ES_URL}/my-index-000001/_validate/query?rewrite=true" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "query": {
    "match": {
      "user.id": {
        "query": "kimchy",
        "fuzziness": "auto"
      }
    }
  }
}'
```
{/* TEST[continued] */}

Use the [**Explain API**](((ref))/search-explain.html) {/*  <DocLink id="enElasticsearchReferenceSearchExplain">explain API</DocLink> */} to find out why a specific document matches or doesnâ€™t match a query:

```bash
curl -X GET "${ES_URL}/my-index-000001/_explain/0" \
-H "Content-Type: application/json" \
-H "Authorization: ApiKey ${API_KEY}" \
-d '{
  "query": {
    "match": {
      "message": "elasticsearch"
    }
  }
}'
```
{/* TEST[setup:messages] */}

The [**Profile API**](((ref))/search-profile.html)
 {/*  <DocLink id="enElasticsearchReferenceSearchProfile">profile API</DocLink> */} provides detailed timing information about a search request.
For a visual representation of the results, use the <DocLink id="serverlessElasticsearchDevToolsSearchProfiler" text="Search Profiler"/>.

<DocCallOut title="Note">
To troubleshoot queries, select **Inspect** in the toolbar.
Next, select **Request**.
You can now copy the query sent to ((es)) for further analysis in Console.
</DocCallOut>

<div id="troubleshooting-searches-settings"></div>

## Check index settings

Index settings {/* <DocLink id="enElasticsearchReferenceIndexModules" section="index-settings">Index settings</DocLink> */} can influence search results. 
For example, the `index.query.default_field` setting, which determines the field
that is queried when a query specifies no explicit field. 
Use the [**Get index settings API**](((ref))/indices-get-settings.html)
 {/* <DocLink id="enElasticsearchReferenceIndicesGetSettings">get index settings API</DocLink> */} 
 to retrieve the settings for an index:

```bash
curl "${ES_URL}/my-index-000001/_settings" \
-H "Authorization: ApiKey ${API_KEY}"
```
{/* TEST[continued] */}

You can update dynamic index settings with the [**Update index settings API**](((ref))/indices-update-settings.html) {/*  <DocLink id="enElasticsearchReferenceIndicesUpdateSettings">update index settings API</DocLink> */}. 
Changing dynamic index settings for a data stream {/*  <DocLink id="enElasticsearchReferenceModifyDataStreams" section="change-a-dynamic-index-setting-for-a-data-stream">Changing dynamic index settings for a data stream</DocLink> */} requires changing the index template used by the data stream.

For static settings, you need to create a new index with the correct settings.
Next, you can reindex the data into that index.
{/*For data streams, refer to <DocLink id="enElasticsearchReferenceModifyDataStreams" section="change-a-static-index-setting-for-a-data-stream">Change a static index setting
for a data stream</DocLink> */}.

<div id="troubleshooting-slow-searches"></div>

## Find slow queries

[Slow logs](((ref))/index-modules-slowlog.html) {/* <DocLink id="enElasticsearchReferenceIndexModulesSlowlog">Slow logs</DocLink> */} 
can help pinpoint slow performing search requests. 
Additionally, [enabling audit logging](((ref))/enable-audit-logging.html) {/*  <DocLink id="enElasticsearchReferenceAuditingSettings">audit logging</DocLink> */} 
can help determine query source.
Add the following settings to the `elasticsearch.yml` configuration file
to trace queries.
The resulting logging is verbose, so disable these settings when not
troubleshooting.

```yaml
xpack.security.audit.enabled: true
xpack.security.audit.logfile.events.include: _all
xpack.security.audit.logfile.events.emit_request_body: true
```

Refer to the following blog for more information: [Advanced tuning: finding and fixing slow Elasticsearch queries](https://www.elastic.co/blog/advanced-tuning-finding-and-fixing-slow-elasticsearch-queries).
